{
  "BuildingName": "House",
  "GeneralSteps": [
    {
      "Id": "GS1",
      "Local": {
        "X": "{Brick200x100x50.Length}/2",
        "Y": "{Brick200x100x50.Width}/2",
        "Z": "{Brick200x100x50.Height}/2"
      },
      "SubStepIds": [ "S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8" ],
      "Repeat": {
        "Count": "({Height}/{Brick200x100x50.Height})/2",
        "OffsetLocal": {
          "X": "{Brick200x100x50.Length}/4",
          "Y": "{Brick200x100x50.Width}*3/2",
          "Z": "{Brick200x100x50.Height}"
        },
        "OffsetOrientation": { "Yaw": "90" }
      }
    },
    {
      "Id": "GS2 - Установка стропил",
      "Local": {
        "X": "0",
        "Y": "{Width}/2",
        "Z": "{Height}"
      },
      "Orientation": { "Yaw": "0" },
      "SubStepIds": [ "R1", "R2", "R3" ],
      "Repeat": {
        "Count": "{RoofRaftCount}",
        "Local": {
          "X": "(({Length} - {Brus.Width} * {RoofRaftCount}) / ({RoofRaftCount} - 1) + {Brus.Width}) * {GeneralStepIndex} + (0.75*{Brus.Width})",
          "Z": "{Height}",
          "Y": "{Width}/2"
        },
        "Orientation": { "Yaw": "0" }
      }
    },
    {
      "Id": "GS3 - Обрешетка крыши",
      "SubStepIds": [ "F1", "F2" ]
    },
    {
      "Id": "GS4 - Кровля",
      "SubStepIds": [ "M1"]
    }
  ],
  "Parameters": [
    {
      "Name": "Height",
      "Value": "270",
      "Description": "Высота дома. Должна быть кратна высоте кирпича."
    },
    {
      "Name": "Length",
      "Value": "800",
      "Description": "Длина дома. Должна быть кратна длине кирпича."
    },
    {
      "Name": "Width",
      "Value": "500",
      "Description": "Ширина дома. Должна быть кратна ширине кирпича."
    },
    {
      "Name": "RoofOffset",
      "Value": "50",
      "Description": "Вылет крыши."
    },
    {
      "Name": "RoofRaftCount",
      "Value": "8",
      "Description": "Количество стропил крыши"
    },
    {
      "Name": "Brus.Width",
      "Value": "15"
    },
    {
      "Name": "Brus.Height",
      "Value": "20"
    },
    {
      "Name": "Plank.Width",
      "Value": "2"
    },
    {
      "Name": "Plank.Height",
      "Value": "10"
    }
  ],
  "SubSteps": [
    {
      "Id": "S1",
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Length}/{Brick200x100x50.Length}",
        "OffsetLocal": {
          "X": "{Brick200x100x50.Length}"
        }
      }
    },
    {
      "Id": "S2",
      "OffsetLocal": {
        "X": "-{Brick200x100x50.Length}/4",
        "Y": "{Brick200x100x50.Width} /2"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Width}/{Brick200x100x50.Length}",
        "OffsetLocal": { "Y": "{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "S3",
      "OffsetLocal": {
        "X": "-15",
        "Y": "-15"
      },
      "OffsetOrientation": {
        "Yaw": "90"
      },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Length}/{Brick200x100x50.Length}",
        "OffsetLocal": { "X": "-{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "S4",
      "OffsetLocal": {
        "X": "15",
        "Y": "-15"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Width}/{Brick200x100x50.Length} - 1",
        "OffsetLocal": { "Y": "-{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "S5",
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "OffsetLocal": {
        "X": "15",
        "Y": "5",
        "Z": "{Brick200x100x50.Height}"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Repeat": {
        "Count": "{Length}/{Brick200x100x50.Length}",
        "OffsetLocal": { "X": "{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "S6",
      "OffsetLocal": {
        "X": "-15",
        "Y": "15"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Width}/{Brick200x100x50.Length} - 1",
        "OffsetLocal": {
          "Y": "{Brick200x100x50.Length}"
        }
      }
    },
    {
      "Id": "S7",
      "OffsetLocal": {
        "X": "-5",
        "Y": "-5"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Length}/{Brick200x100x50.Length}",
        "OffsetLocal": { "X": "-{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "S8",
      "OffsetLocal": {
        "X": "5",
        "Y": "-5"
      },
      "OffsetOrientation": { "Yaw": "90" },
      "Action": "Put",
      "ElementId": "Brick200x100x50",
      "Repeat": {
        "Count": "{Width}/{Brick200x100x50.Length}",
        "OffsetLocal": { "Y": "-{Brick200x100x50.Length}" }
      }
    },
    {
      "Id": "R1",
      "Action": "Put",
      "ElementId": "Wood_Brus",
      "ElementParams": [ "{Width} + (2 * {RoofOffset})", "{Brus.Height}", "{Brus.Width}", "1" ],
      "OffsetLocal": { "Z": "{Brus.Height} / 2" }
    },
    {
      "Id": "R2",
      "Action": "Put",
      "ElementId": "Wood_Brus",
      "ElementParams": [ "(({Width} + (2 * {RoofOffset})) -2 * {Brus.Height})/ sqrt(2)", "{Brus.Height}", "{Brus.Width}", "1" ],
      "OffsetLocal": {
        "X": "{Brus.Width}",
        "Y": "(-(({Width} + (2 * {RoofOffset}))/2 - {Brus.Height} / sqrt(2)) / 2) + ({Brus.Width} / sqrt(2))",
        "Z": "((({Width} + (2 * {RoofOffset}))/2 - {Brus.Height} / sqrt(2)) / 2 )"
      },
      "OffsetOrientation": {
        "Pitch": "180",
        "Roll": "45"
      }
    },
    {
      "Id": "R3",
      "Action": "Put",
      "ElementId": "Wood_Brus",
      "ElementParams": [ "({Width} + (2 * {RoofOffset}) - 2 * {Brus.Height})/ sqrt(2)", "{Brus.Height}", "{Brus.Width}", "1" ],
      "OffsetLocal": {
        "Y": "(({Width} + (2 * {RoofOffset}))/2 - {Brus.Height} / sqrt(2)) - 2 * ({Brus.Width} / sqrt(2))"
      },
      "OffsetOrientation": {
        "Roll": "-90"
      }
    },
    {
      "Id": "F1",
      "Action": "Put",
      "ElementId": "Wood_Brus",
      "ElementParams": [ "{Length} + (2 * {RoofOffset})", "{Plank.Height}", "{Plank.Width}", "0" ],
      "Local": {
        "X": "{Length}/2",
        "Y": "-{RoofOffset} + ({Plank.Width} / 2)",
        "Z": "{Height} + ({Plank.Height} / 2)"
      },
      "Orientation": {
        "Yaw": "90",
        "Pitch": "-45"
      },
      "Repeat": {
        "Count": "(({Width} * sqrt(2)) / 2) / ({Plank.Height} * 2) - 2",
        "OffsetLocal": {
          "Y": "{Plank.Height} * 2",
          "Z": "{Plank.Height} * 2"
        }
      }
    },
    {
      "Id": "F2",
      "Action": "Put",
      "ElementId": "Wood_Brus",
      "ElementParams": [ "{Length} + (2 * {RoofOffset})", "{Plank.Height}", "{Plank.Width}", "0" ],
      "Local": {
        "X": "{Length}/2",
        "Y": "{Width} + {RoofOffset} - (1 * ({Plank.Width} / 2))",
        "Z": "{Height} + ({Plank.Height} / 2)"
      },
      "Orientation": {
        "Yaw": "90",
        "Pitch": "45"
      },
      "Repeat": {
        "Count": "(({Width} * sqrt(2)) / 2) / ({Plank.Height} * 2) - 2",
        "OffsetLocal": {
          "Y": "- {Plank.Height} * 2",
          "Z": "{Plank.Height} * 2"
        }
      }
    },
    {
      "Id": "M1",
      "Action": "Put",
      "ElementId": "RoofSurface",
      "ElementParams": [ "({Width} + {RoofOffset}) / 2 + ({Plank.Width} + {Brus.Height}) * sqrt(2)", "{Length} +  2 *{RoofOffset}" ],
      "Local": {
        "X": "-{RoofOffset}",
        "Y": "{Width} / 2",
        "Z": "{Height} + ({Width} + {RoofOffset}) / 2 + ({Plank.Width} + {Brus.Height}) * sqrt(2)"
      },
      "Orientation": { "Yaw": "0" }
    }
  ],

  "Elements": [
    {
      "Id": "Brick200x100x50",
      "Type": "Internal",
      "Length": "20",
      "Width": "10",
      "Height": "5"
    },
    {
      "Id": "Wood_Brus",
      "Type": "Custom",
      "Material": "Wood",
      "Comments": "Параметрический брус. Arg1 - длина, Arg2- высота, Arg3 - ширина, Arg4 - тангенс угла запила.",
      "Geometry": {
        "Plane": "XY",
        "Profile": {
          "Points": [
            {
              "Id": "1",
              "U": "-{Wood_Brus.Arg1}/2",
              "V": "-{Wood_Brus.Arg2}/2"
            },
            {
              "Id": "2",
              "U": "-{Wood_Brus.Arg1}/2 + ({Wood_Brus.Arg2} * {Wood_Brus.Arg4})",
              "V": "{Wood_Brus.Arg2}/2"
            },
            {
              "Id": "3",
              "U": "{Wood_Brus.Arg1}/2 - ({Wood_Brus.Arg2} * {Wood_Brus.Arg4})",
              "V": "{Wood_Brus.Arg2}/2"
            },
            {
              "Id": "4",
              "U": "{Wood_Brus.Arg1}/2",
              "V": "-{Wood_Brus.Arg2}/2"
            }
          ],
          "Contur": [ "1", "2", "3", "4" ],
          "Mesh": [ "1", "2", "3", "1", "3", "4" ]
        },
        "Extrude": "{Wood_Brus.Arg3}"
      }
    },
    {
      "Id": "RoofSurface",
      "Type": "Custom",
      "Material": "Wood",
      "Comments": "Крышка семитричная, 90 градусов. Arg1 - длина катета. Arg2 - продольность.",
      "Geometry": {
        "Plane": "XY",
        "Profile": {
          "Points": [
            {
              "Id": "1",
              "U": "-{RoofSurface.Arg1}",
              "V": "-{RoofSurface.Arg1}"
            },
            {
              "Id": "2",
              "U": "-{RoofSurface.Arg1}",
              "V": "-{RoofSurface.Arg1} + 1"
            },
            {
              "Id": "3",
              "U": "0",
              "V": "1"
            },
            {
              "Id": "4",
              "U": "{RoofSurface.Arg1}",
              "V": "-{RoofSurface.Arg1} + 1"
            },
            {
              "Id": "5",
              "U": "{RoofSurface.Arg1}",
              "V": "-{RoofSurface.Arg1}"
            },
            {
              "Id": "6",
              "U": "0",
              "V": "0"
            }
          ],
          "Contur": [ "1", "2", "3", "4", "5", "6" ],
          "Mesh": [ "1", "2", "3", "1", "3", "6", "3", "4", "5", "6", "4", "5" ]
        },
        "Extrude": "{RoofSurface.Arg2}"
      }
    }
  ]
}